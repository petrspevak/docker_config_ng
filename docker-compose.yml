# Docker Compose configuration for a Symfony project with NG specifics
# Author: Petr Spěvák <petr@spevak.eu>
# Boilerplate repository: https://github.com/petrspevak/docker_config_ng
#
# Configuration is centralized in .env file (copy .env.example to .env)

services:
  app:
    user: "${UID:-1000}:${GID:-1000}"
    build:
      context: ./
      dockerfile: ./docker/php/Dockerfile
      args:
        USER_ID: ${UID:-1000}
        GROUP_ID: ${GID:-1000}
    ports:
      - "${DOCKER_APP_PORT}:80"
    volumes:
      - .:/var/www/html
    depends_on:
      - mysql
    environment:
      TZ: ${TZ}
      APP_ENV: dev
      APP_SECRET: 3bc1e76609756e82a2e3637e8ec756ee
      DATABASE_URL:
      DATABASE_HOST: ${DOCKER_DATABASE_HOST}
      DATABASE_PORT: ${DOCKER_MYSQL_PORT}
      DATABASE_NAME: ${DOCKER_DATABASE_NAME}
      DATABASE_USER: ${DOCKER_DATABASE_USER}
      DATABASE_PASSWORD: ${DOCKER_DATABASE_PASSWORD}
      MAILER_URL: null://localhost

  mysql:
    image: mysql:8.0
    volumes:
      - mysql-data:/var/lib/mysql
    environment:
      TZ: ${TZ}
      MYSQL_ROOT_PASSWORD: ${DOCKER_MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DOCKER_DATABASE_NAME}
      MYSQL_USER: ${DOCKER_DATABASE_USER}
      MYSQL_PASSWORD: ${DOCKER_DATABASE_PASSWORD}
    ports:
      - "${DOCKER_MYSQL_PORT}:3306"
    restart: unless-stopped

  phpmyadmin:
    depends_on:
      - mysql
    image: phpmyadmin
    ports:
      - "${DOCKER_PHPMYADMIN_PORT}:80"
    environment:
      TZ: ${TZ}
      PMA_HOST: ${DOCKER_DATABASE_HOST}
      MYSQL_ROOT_PASSWORD: ${DOCKER_MYSQL_ROOT_PASSWORD}
      UPLOAD_LIMIT: 1G

volumes:
  mysql-data:
